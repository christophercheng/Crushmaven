<!DOCTYPE html>
<html lang="en">
    <head>
	    <meta http-equiv="Content-type" content="text/html"; charset="UTF-8" />
	    <meta name="description" content="More than just friends?  Discover anonymously if the person you're attracted to feels the same at crushmaven.com." />
	    <meta name="robots" content="all,index" />
	    <meta name="Revisit-After" content="30 Days" />
	    <meta http-equiv="X-UA-Compatible" content="IE=edge" /> <!-- ie8 - ignore compatibility option-->
		<title>CrushMaven - {% block title %}{% endblock %}</title>    	
	    {% block extrahead %}{% endblock %}

	    <link rel="shortcut icon" type="image/x-icon" href="{{ STATIC_URL }}images/cm_favicon1.gif" />
	    <link rel="icon" type="image/x-icon" href="{{ STATIC_URL }}images/cm_favicon1.gif" /> 

	    <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/themes/base/jquery-ui.css">
		<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
	    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	    {% if no_track != True %}
	    <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    	  ga('create', 'UA-46806664-1', 'crushmaven.com');
	    	  ga('send', 'pageview');
	    </script>
	    {% endif %}
		<link type="text/css" href="/static/fbdater_v1.css?version=1" rel="stylesheet"  />    
	    
	    <link type="text/css" href="{{ STATIC_URL }}friend-selector/friend_selector_v1.css" rel="stylesheet" />
	
	    <link rel="stylesheet" href="{{ STATIC_URL }}contactable/contactable_v1.css" type="text/css" />
	    <link rel="stylesheet" href="{{ STATIC_URL }}qtip/jquery.qtip.css" type="text/css" />
	    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Varela+Round">
		
    </head>
<body>
{% if request.GET.signin %}
//<script>
//$("#mobile_warning_modal").dialog({dialogClass:"mobile_warning_dialog",modal: true,resizable:false, autoOpen: false, width:500});
// run a mobile check if user has just logged in
//(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);
//if (jQuery.browser.mobile) {
//	console.log("display mobile warning!");
	
	//$("#mobile_warning_modal").html("You are a mobile User! aha!");
	//$('#mobile_warning_modal').dialog("open");
	//display full page interstitial
//}

//</script>
{% endif %}

<script> 
jQuery(document).ready(function($) {

	function toTitleCase(str)
	{
	    return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
	}
	
	<!-- AJAX CALL INITIALIZATION -->
	// default to 60 seconds for all ajax calls: (lineup initialization will require longer wait time)
	$.ajaxSetup({timeout: '60000'});
 
	<!-- INITIALIZE FB JS INTEGRATION -->
	window.fbAsyncInit = function() {
	  FB.init({ 
	  	appId:  {{facebook_app_id}}, 
	  	status: true, 
	  	cookie: true,
	  	xfbml: true,
	  	oauth: true,
	  });
  	  	// Additional init code here
	}; // close window.fbAsyncINit
	// Load the SDK Asynchronously
  // Load the SDK asynchronously
  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/all.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));

	function login(connect_callback) {
	    FB.login(function(response) {
	        if (response.authResponse) {
	        		if (connect_callback)
	        			connect_callback();
	            // connected
	        } else {
	            // cancelled
	
	        }
	    });
	}// close function login

	/* -------  HANDLERS for Friend Selector and Contactable Form -------- */
	  $.getScript('{{ STATIC_URL }}friend-selector/friend_selector_v1.js').done(function(script,scriptStatus){
		  $(".bt-fs-dialog").fSelector({ // call the .fSelector function and send it a massive dictionary of option values
			  accessToken: "{{request.user.access_token}}",
			  facebookID: "{{request.user.username}}",
			  malePref:{% if request.user.gender_pref = 'F' %} false {% elif request.user.gender_pref = 'M' %} true {% else %} null{% endif %},
		    maleGender: {% if request.user.gender = 'F' %} false {% elif request.user.gender_pref = 'M' %} true {% else %} null{% endif %},
		    minimum_samegender_friends:"0",//"{{minimum_samegender_friends}}",
		    minimum_crushgender_friends:"0",//"{{minimum_crushgender_friends}}",
		    max:18,
			 excludeIds: "{% for crush_rel in request.user.crush_crushrelationship_set_from_source.all %}{{crush_rel.target_person.username}}{% if not forloop.last %},{% endif %}{% endfor %}",
		    closeOverlayClick: false,
		    overlayOpacity: "0.5",
		    overlayColor: '#000',
		    closeOnSubmit: true,
		    showSelectedCount: true,
		    color: "default",
		    showRandom:false,
		    lang: {
		      title: "Add Crushes",
		      searchText: "Enter a friend's name",
		      fbConnectError: "You must be logged in to Facebook in order to use this feature.",
		      selectedCountResult: "You have choosen {0} people.",
		      selectedLimitResult: "Limit is {0} people.",
		      ajaxError:"{{ajax_error}}",
		    },
		    onSubmit: function(response){
					add_friends_to_db(response);
		    },
		    onError: function(error_message){
		    	var display_message="{{generic_error_message}}";
		    	if (error_message!== 'undefined')
		    		display_message=error_message;
		    		
		    	window.alert_modal("Friend Selector Problem", display_message, $('#fs-dialog-box-wrap') );
		    },
		    onClose: function(){
		    	$("body").css({ 'overflow-x':'auto','overflow-y': 'scroll' });
		    },
		    onStart: function(){
		    	 $("body").css({ overflow: 'hidden' });
		    	 //$("#fs-dialog-box-wrap").draggable({handle:"#fs-dialog-title",containment:$("#fs-overlay")});
		    	// window.scrollTo(0,0); // hack to allow dialog to show - cause it always loads relative to fixed elements
		    	 //$('body').css('overflow-y','hidden !important');
		    },
		    }); // close off .bt-fs-dialog.fSelector
		   }); // close off getScript.done

	  /* -----------    Handler For Contactable Form ---------- */
	  $.getScript('{{ STATIC_URL }}contactable/contactable_v1.js').done(function(script,scriptStatus){
			  $(function(){$('#contactable').contactable({csrf_token: '{{csrf_token}}'});});
		}); // close off $.getScript for Friend Selector Dialogs

	  
	  /* ---------------------------------------------
	 	
		CREDIT PURCHASE DIALOG HANDLING
	
	   * -------------------------------------------- */
	  
	$("#credit_check_modal").dialog({dialogClass:"credit_check_dialog",modal: true, draggable:false,resizable:false, autoOpen: false,width:410,open: function(event, ui) {$("body").css({ overflow: 'hidden' }) },beforeClose: function(event, ui) {$("body").css({ 'overflow-x':'auto','overflow-y': 'scroll' })}});
	
	
	window.purchase_feature = function(data){
		load_url="/credit_checker/";
		dialog_div = $("#credit_check_modal");
		dialog_div.attr("feature_id",data.feature_id)
		$(".credit_check_dialog").children(".ui-dialog-titlebar").append("<span class='help_icon'>?</span>");
		window.wait_modal_open();
		dialog_div.load(load_url,data,function(responseTxt,statusTxt,xhr){
			window.wait_modal_close();
			if (statusTxt!="success"){
					$(this).html(data.ajax_error);
			  }
			dialog_div.dialog("open");
			$(':focus').blur();
			dialog_div.dialog("moveToTop");
		}); 
		return false;
	};
	
	window.purchase_conversation = function(csrf_token,attraction_id,purchase_callback_name) {
		purchase_callback_name = typeof purchase_callback_name !== 'undefined' ? purchase_callback_name : "";
		data = {};
		data['csrfmiddlewaretoken']=csrf_token;
		data['success_path'] = '/messages/converse/' + attraction_id;	
		data['cancel_url'] =  '{{request.get_full_path}}';
		var unique_id = attraction_id;
		data['unique_id'] = unique_id;
		data['feature_id'] = '4';
		if (purchase_callback_name=='')
			data['purchase_callback_name'] = 'window.redirect_to_conversation(' + attraction_id + ')';
		else
			data['purchase_callback_name'] = purchase_callback_name;
		data['ajax_error']='{{ajax_error}}';
		purchase_feature(data);
	}; 
			   
		window.redirect_to_conversation=function(attraction_id){
		  	location.href="/messages/converse/" + attraction_id;
		};		  
	  
	  /* ---------------------------------------------
	 	
	 		APP INVITE MODAL
	 	
	 * -------------------------------------------- */
	window.app_invite_modal=null;
	$(".app_invite_link,#invite_interstitial_modal").on("click", ".app_invite", function(e) {
	    {% if no_track != True %}
	    ga('send', 'event', 'button', 'click', 'invite_crush_button');
	    {% endif %}
		e.preventDefault();
		// only initialize jquery modal dialog once per page load

		if (!window.app_invite_modal)
			window.app_invite_modal = $("#app_invite_modal").dialog({dialogClass:"app_invite_dialog", draggable:false,resizable:false, modal: true, autoOpen: false,open: function(event, ui) {$("body").css({ overflow: 'hidden' }) },beforeClose: function(event, ui) {$("body").css({ 'overflow-x':'auto','overflow-y': 'scroll' })}});
		window.app_invite_modal.html('<div id="site-loading"></div>');
		
		$(".app_invite_dialog").children(".ui-dialog-titlebar").append("<span class='help_icon'>?</span>");
		
		window.wait_modal_open();
		var crush_username=$(this).attr('crush_username');	
		var crush_fullname=$(this).attr('crush_fullname');
		var crush_firstname = crush_fullname;
		var space_index = crush_fullname.indexOf(' ');
		if (space_index > 0)
			crush_firstname=crush_firstname.substr(0,space_index);
		var load_url="/app_invite_form_v2/" + crush_username + "/";
		window.app_invite_modal.load(load_url,{'crush_fullname':crush_fullname,'csrfmiddlewaretoken':'{{csrf_token}}' },function(responseText,textStatus,XHR){
			window.wait_modal_close();
			if (textStatus!="success"){
				if (!window.access_token_error(responseText))
					$(this).html("{{ajax_error}}");
			}
			else{
				window.app_invite_modal.dialog("option","title", "Anonymously Invite " + crush_firstname);
				window.app_invite_modal.dialog('open');
				$(':focus').blur();
			}
		});	
	});	
	
	
	//-------------  App Invite Interstitial ------------------
	// launch interstitial
	//
	//		inputs:
	//			json of attractions: attraction_username = attraction_full_name
	//			redirect page (where to go after dialog closes) 
	//		functionality:
	//			dynamically build dialog html elements based off of the inputted array
	
	window.invite_interstitial_modal=null;
	window.invite_interstitial_modal_redirect_url="";
	window.launch_invite_interstitial = function(attraction_json,redirect_url) {
			// only initialize jquery modal dialog once per page load
			
			if (!window.invite_insterstitial_modal)
				window.invite_interstitial_modal = $("#invite_interstitial_modal").dialog({dialogClass:"invite_interstitial_dialog", draggable:false,resizable:false, width: '460px',modal: true, close: function(){location.href=redirect_url;},autoOpen: false,open: function(event, ui) {$("body").css({ overflow: 'hidden' }) },beforeClose: function(event, ui) {$("body").css({ 'overflow-x':'auto','overflow-y': 'scroll' })}});
			else
				window.invite_interstitial_modal.dialog({close: function(){location.href=redirect_url;}})
			var modal_html ="";
			modal_html += '<div class="modal_main_content">';
			
			$(".invite_interstitial_dialog").children(".ui-dialog-titlebar").append("<span class='help_icon'>?</span>");


			$(".invite_interstitial_dialog .help_icon").qtip({
				content:{
					text:$('#invite_dialog_one_help_content'),
					title:'Why do we send anonymous invites?'
				},
				show:{
					delay:0,
				},
				hide:{
					delay:500,
					fixed:true,
				},
				style:{
					classes: 'qtip-blue qtip-rounded qtip-shadow',
					tip:{
						corner:true
					}
				}
			});	
			
			var counter = 0;
			for (var username in attraction_json) {
				counter++;
				if (counter == 1)
					modal_html += '<div class="attraction_invite_row first_row">';
				else
					modal_html += '<div class="attraction_invite_row">';
					// picture
					modal_html +='<img src="http://graph.facebook.com/' + username + '/picture?width=30&height=30">';
					// full name
					var fullname = 	toTitleCase(attraction_json[username]);
					modal_html +='<span class="attraction_invite_full_name">' + fullname + '</span>';
					// invite button (or invite sent text)
					modal_html +='<div class="attraction_invite_button" username="' + username + '"><button class="app_invite" crush_username="' + username + '" crush_fullname="' + fullname + '">Anonymously Invite</button></div>';
				modal_html += '</div>'; //close off attraction_invite_row div
			}
				
			modal_html += '</div>';//close off dialog_main_content div
			modal_html += '<div class="ui-dialog-buttonpane">';
			modal_html += '<div class="ui-dialog-buttonset">';
			modal_html += '<button type="button" onclick="window.invite_interstitial_modal.dialog(\'close\');" class="site_dialog_button site_dialog_cancel_button" ><span class="ui-button-text ">send invites later</span></button>';
			modal_html += '</div></div>';
			
			window.invite_interstitial_modal.html(modal_html);
			window.invite_interstitial_modal.dialog('open');
			$(':focus').blur();
	};
	
	
	// input: attraction: username represents the attraction that was just invited  
	// functionality: auto redirect to inputted redirect page if all attraction invites sent
	//	 		if redirect page is same as current page, just close dialog
	//	 		if at least one attraction invite not sent, then
	//			replace button of newly invited attraction with 'invite(s) sent' 
	window.update_invite_interstitial = function(attraction_username){
		if (!window.invite_interstitial_modal || !window.invite_interstitial_modal.dialog( "isOpen" ))
			return false;
		if (window.app_invite_modal)
			window.app_invite_modal.dialog('close');
		 // search for the associated button and update it's html
		target_element = $('#invite_interstitial_modal .modal_main_content .attraction_invite_row .attraction_invite_button[username=' + attraction_username + ']');
		target_element.html('invite(s) sent');
		
		// if no buttons exist, then auto close the dialog and redirect it 
		if ($('.attraction_invite_button button').length == 0)
			window.invite_interstitial_modal.dialog("close");
	}
	
  function add_friends_to_db(response)
  //response is a json object of username:fullname with username having extra character at end representing friendship type
  {           
                window.wait_modal_open();
                var result_dictionary = {};
                var attraction_invites_json={};
                result_dictionary["csrfmiddlewaretoken"]="{{csrf_token}}";
                for (attraction in response){
                        result_dictionary[attraction.slice(0,-1)]=attraction.slice(-1);
                        attraction_invites_json[attraction.slice(0,-1)]=response[attraction];
                };
        $.post('/ajax_add_crush_targets/',result_dictionary, function(){
                // on success redirect to the crush page
                window.wait_modal_close();
                window.launch_invite_interstitial(attraction_invites_json,'/your_crushes/'); 
                //document.location.href='/your_crushes/'; // reload page
        }).fail(function(error){
                window.alert_modal("Add Crushes - Problem", error.responseText,$('#fs-dialog-box-wrap') );
  });
  }
	// -------------  CSS additions ------------------

	$.maxZIndex = $.fn.maxZIndex = function(opt) {
	    /// <summary>
	    /// Returns the max zOrder in the document (no parameter)
	    /// Sets max zOrder by passing a non-zero number
	    /// which gets added to the highest zOrder.
	    /// </summary>    
	    /// <param name="opt" type="object">
	    /// inc: increment value, 
	    /// group: selector for zIndex elements to find max for
	    /// </param>
	    /// <returns type="jQuery" />
	    var def = { inc: 10, group: "*" };
	    $.extend(def, opt);    
	    var zmax = 0;
	    $(def.group).each(function() {
	        var cur = parseInt($(this).css('z-index'));
	        zmax = cur > zmax ? cur : zmax;
	    });
	    if (!this.jquery)
	        return zmax;
	
	    return this.each(function() {
	        zmax += def.inc;
	        $(this).css("z-index", zmax);
	    });
	}
	$("#alert_modal").dialog({dialogClass:'alert_modal_dialog blacktop', draggable:false,resizable:false, modal: true, autoOpen: false,open: function(event, ui) {$("body").css({ overflow: 'hidden' }) },beforeClose: function(event, ui) {$("body").css({ 'overflow-x':'auto','overflow-y': 'scroll' })},buttons: {"Ok": function() {$(this).dialog("close");}}});
	$("#wait_modal").dialog({dialogClass:'wait_modal_dialog', draggable:false,resizable:false, height:80,width:300,modal: true, autoOpen: false,open: function(event, ui) {$("body").css({ overflow: 'hidden' }) },beforeClose: function(event, ui) {$("body").css({ 'overflow-x':'auto','overflow-y': 'scroll' })}}); 
 
	window.wait_modal_open=function(custom_message,calling_jquery_element){
		var message="please wait...";
		if (custom_message !== 'undefined' && custom_message !== "")
			message=custom_message;
		
		if (!$("#wait_modal").dialog("isOpen")){
				$('#wait_modal').dialog("open");
		}
		
		if (typeof calling_jquery_element !== 'undefined')	{
			var top_z_index=parseFloat($(calling_jquery_element).css('z-index'));
			var dialog_index = top_z_index + 2;
			var overlay_index = top_z_index + 1;
			var old_dialog_z = $(".wait_modal_dialog").css('z-index');
			$(".wait_modal_dialog").css('z-index',dialog_index.toString());
			var old_overlay_z = $(".ui-widget-overlay").css('z-index'); // set back to this z-index when close pressed
			$('.ui-widget-overlay').css('z-index',overlay_index.toString()).addClass('wait_mode');
			$('#wait_modal').dialog("option",{beforeClose:function(){$("body").css({ 'overflow-x':'auto','overflow-y': 'scroll' });$('.wait_modal_dialog').css('z-index',old_dialog_z);$('.ui-widget-overlay').css('z-index',old_overlay_z).removeClass('wait_mode')}});
		}
		$(".ui-widget-overlay").fadeTo(0,.1);
		$("#wait_modal").html(message);
	};  

	window.wait_modal_close=function(){
		if (!$("#wait_modal").dialog("isOpen"))
			return;
		$(".ui-widget-overlay").fadeTo(0,.6);//put it back where it used to be
	 		$('#wait_modal').dialog("close");
	 };  
  
	 window.alert_modal=function(title, message,calling_jquery_element){
	   $("#alert_modal").html(message);
	   $("#alert_modal").dialog({dialogClass:'alert_modal_dialog blacktop', draggable:false,title:title,show:'fade',beforeClose:function(){$("body").css({ 'overflow-x':'auto','overflow-y': 'scroll' });$(".ui-widget-overlay").css('z-index',old_overlay_z);window.wait_modal_close()}});
		$('#alert_modal').dialog("open");
		
		if (typeof calling_jquery_element === 'undefined'){
				var top_z_index = parseInt($.maxZIndex());
		}
		else {
			var top_z_index=parseFloat($(calling_jquery_element).css('z-index'));
		}
		var dialog_index = top_z_index + 2;
		var overlay_index = top_z_index + 1;
		$(".alert_modal_dialog").css('z-index',dialog_index.toString());
		var old_overlay_z = $(".ui-widget-overlay").css('z-index'); // set back to this z-index when close pressed
		$(".ui-widget-overlay").css('z-index',overlay_index.toString());
		$(':focus').blur();
  };  
  
  window.access_token_error=function(responseText){
		if (responseText.indexOf("HTTPError") != -1){
		  reauthorize_user();
			return true;
		}
		else 
			return false;
	};

	var reauthorize_user=function(){
		window.alert_modal('User Authentication', "For your security, we must periodically re-confirm your Facebook identity.  Our apologies for the inconvenience.",$('#fs-dialog-box-wrap'));
		setTimeout(function(){location.href="/facebook/login"},1000);
	};
	
	var send_fb_invite = function(recipient_id,crush_short_name,crush_first_name,crush_last_name){
		var share_link = 'http://{{ request.META.HTTP_HOST }}' + '/admirer_for/' + crush_first_name + '/' + crush_last_name[0] + '/';
		console.log("new share link: ",share_link);
		window.wait_modal_open();
		FB.api('/?id='+ share_link + '&scrape=true','POST',{scrape : 'true'},function(response){ // trigger facebook scraper to examine this page
			if (!response || response.error){
				console.log(response);
				window.wait_modal_close();
				window.alert_modal("Facebook Messaging Problem","Sorry, but we're having difficulty cooking up a message through Facebook.  Please try again later");
			}
			else {
		  	FB.ui({method: 'send',
		  				name: crush_short_name + " has an admirer!",
		  				to: recipient_id,
		  				link: share_link,
		  				description:'CrushMaven is a new matchmaking service that finds out if someone you like feels the same - anonymously and without any social awkwardness. Learn more at CrushMaven.com.'
		      },
		      function(response){
		      		window.wait_modal_close();
		         // regardless of whether user cancels or sends message, reload the appropriate attraction page
		         if (response != null && response['error_code'] == null){	
						  	$(".inactive_crushed_friends").load('/ajax_friends_with_admirers_content/' + recipient_id,function(responseText,textStatus,xhr){
								if (xhr.status==405)
									reauthorize_user();
				  			});
		  				} //close off if (response != null) 
		      }      
		    );// close off fb.ui
		   }}); // close off FB.api
  }; // close off send_fb_invite
   
  $(".inactive_crushed_friends").on('click', '#send_fb_invite', function(){
           var crush_id = $(this).attr('crush_username');
           var crush_name = $(this).attr('crush_name');
           var crush_first_name = $(this).attr('crush_first_name');
           var crush_last_name = $(this).attr('crush_last_name');
           {% if no_track != True %}
           ga('send', 'event', 'button', 'click', 'notify_inactive_friend_button');
           {% endif %}
           send_fb_invite(crush_id,crush_name,crush_first_name, crush_last_name);
  });
  
// QUERY INACTIVE FRIENDS WITH ADMIRERS
$(".reprocess_friends_with_admirers_section").parent('ul').load('/ajax_friends_with_admirers_content/',function(responseText,textStatus,xhr){
	if (xhr.status==405)
  			reauthorize_user();
  }); 
// INITIALIZE FEEDBACK FORM 
 
 
// HANDLE SETTINGS MENU CLICK
function openSubMenu() {
	var show_me = $(this).find('ul');
	$(this).find('a').css('color','white');
			show_me.show(0);
}; 
function closeSubMenu() {
	var hide_me = $(this).find('ul');
			$(this).find('a').css('color','');
			$(hide_me).hide(0);
};
$('.drop_down_menu_link > li.submenu').hover(openSubMenu,closeSubMenu);

$('#center_header_menu #get_started_link').hover(function(){$(this).css('color','#09ABE8')},function(){$(this).css('color','white')});

//HANDLE clicking of drop down menu links
$('.header_container .drop_down_menu_link li.submenu').click(function(e){
	e.stopPropagation();
	var menu_element = $(this).find('ul');
	var menu_element_id=menu_element.attr('id');

	if ($(menu_element).is(":visible")){
		$(menu_element).hide(0);
	}
	else{
		$(menu_element).show(0);
	}
		$('.popup:not(#' + menu_element_id + ')').hide();
});

// HANDLE TITLE BAR OPTIONS SUBMENU CLICK
$('.title_bar_option a').bind('click',function(){
	$(this).parent().children('ul').toggle();
});
	
// auto close any popups when clicking elsewhere
$('body').bind('click',function(){
	$('.popup').hide();
});
$('body').on('click',".popup_link",function(e){
  e.stopPropagation();
});

/* ---------------------------------------------
 	
		Help Popup Animation
	
* -------------------------------------------- */
	
	//handle help icon show and hide
	$('.new_user_instructions').each(function(){window.scrollTo(0,0);$(this).delay(500).show(1000)});
	$('.new_user_sub_instructions').each(function(){window.scrollTo(0,0);$(this).delay(500).show(1000)});
	$('.new_user_instructions .help_icon').click(function(){
		$(this).parent().hide(500);
		$('.new_user_sub_instructions').hide(500);
	});

window.handle_window_resize=function(){
	$('.ui-dialog-content:visible').each(function(){
		var dialog = $(this).data("dialog");
		dialog.option("position","center");
		});
};
var timeoutPointer;
$(window).resize(function(){
	clearTimeout(timeoutPointer);
	timeoutPointer = setTimeout(window.handle_window_resize,100);
});


/*  TOOLTIP SUPPORT */
$(".help_icon").html("?");

$(".tooltip_close").click(function(){
	$('.qtip').hide();
});

$(".tooltip_subtitle").click(function(){
	var current_content = $(this).parent().children('.tooltip_content');
	$(".tooltip_subtitle").not(this).css('font-weight','normal').css('font-size','11px');
	$(this).css('font-weight','bold').css('font-size','12px');
	$(this).parent().parent().find('.tooltip_relatedcontent').not(current_content).hide();
	if (current_content.css("display")=="none")
		current_content.css("display","block")
	else
		current_content.css("display","none")
})

/* ---------------------------------------------
	
	NEW USER INSTRUCTION - SHOW MORE LINK HANDLER

* -------------------------------------------- */

$('.show_more').click(function(){
    {% if no_track != True  %}
    ga('send', 'event', 'button', 'click', 'show_more_help_button');
    {% endif %}
	$(this).hide();
	$('.second_instruction_section').show(200);
	$('.first_instruction_section .show_less').show();
	setTimeout(function(){$('.new_user_instructions').addClass('expanded');},100);
	
});
$('.show_less').click(function(){
	$(this).hide();
	
	{% if no_track != True  %}
    ga('send', 'event', 'button', 'click', 'show_less_help_button');
    {% endif %}
	$('.show_more').show();
	$('.second_instruction_section').hide(200);
	setTimeout(function(){$('.new_user_instructions').removeClass('expanded');},100);
});

$('.bt-fs-dialog').click(function(){
	{% if no_track != True  %}
    ga('send', 'event', 'button', 'click', 'friend_selector_all_buttons');
    {% endif %}
	window.wait_modal_open();
})

}); // close of jQuery(document).ready

</script>
<div id="fb-root"></div> 
<div class="header">
	<div class="header_container">{% include "navigation_top.html" %}</div>
</div><!-- close off header divs -->

<div class="main_container">
	<div class="left_sidebar">
			<div class="left_sidebar_container">{% include "navigation_left_singles.html" %}</div>
	</div> <!-- close off left_sidebar -->
	<div class="center_panel">
		<div class="center_panel_container">
			{% block content %}
			{% endblock %}
		</div> <!-- close off center_content_container -->
	</div> <!-- close off center_panel -->
	<div class="right_sidebar">
	<div class="right_sidebar_container">{% include "navigation_right.html" %}</div>
</div> <!-- close off right_sidebar -->
</div> <!-- close off main_container -->
<div id="alert_modal" title="Something's Not Right"></div>
<div id="wait_modal">Please Wait</div>
<div id="app_invite_modal" title="Anonymously Invite"></div>
<div id="invite_interstitial_modal" title = "Want a response? Invite them to CrushMaven!"></div>
<div id="credit_check_modal" title="Feature Purchase"></div>
<div id="mobile_warning_modal" title="Mobile Site Warning"></div>
<div id="contactable"></div><!-- contactable html placeholder -->

</body>

<span class="help_dialog_content" id="invite_dialog_one_help_content">
	<span class="tooltip_content tooltip_maincontent">
	To determine if your crush feels the same as you, we need to first get them signed into our app.
	We do this by sending them an anonymous email notifying them of their secret admirer.
	</span>
	<span class="tooltip_close">close</span>
</span>

</html>
