{% extends "base.html" %}

{% block content %}

{% load fbdater_extras %}

<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/jquery-ui.min.js"></script>


<div id="dialog_member_add" title="Lineup Confirmation">Are you sure about this person?</div>

<script type="text/javascript">
$(document).ready(function() 
{
        $("#dialog_member_add").dialog({modal: true, autoOpen: false});
        $("a.member_add").click(function(e) {
     		var parent = $(this).parent();				
            var url;
            var text= "Are you sure you want to add " + $(this).attr('name') + " as a ";
            var bIsCrush=true;
            if ($(this).attr('add_type') == "crush")    {
            	url="/ajax_add_lineup_member/crush/{{admirer_rel.admirer_display_id}}/" +  $(this).attr('username') + " #choice"; 
            	text = text + "crush?";
            	}
            else {
            	url="/ajax_add_lineup_member/platonic/{{admirer_rel.admirer_display_id}}/" + $(this).attr('username') + " #choice"; 
            	text = text + "platonic_friend?";
            	bIsCrush=false;
            	}
            e.preventDefault();
            $("#dialog_member_add").text(text);
            $("#dialog_member_add").dialog('option', 'buttons', {
       			"Add": function() { 
       				parent.load(url, function(){
       				       				// call an ajax function on the elements which display number of crushes or platonics
       					if (bIsCrush) 
	       					$("#num_crushes_in_progress").load("/ajax_update_num_crushes_in_progress");
       					else 
       						$("#num_platonic_friends").load("/ajax_update_num_platonic_friends");   				
       				});
       				$(this).dialog("close");
				},   
        		"Cancel": function() {$(this).dialog("close");
        		}
    		});
            $("#dialog_member_add").dialog("open");
            return false;
        });
});

</script>


<h2>Lineup for secret admirer id: {{admirer_rel.admirer_display_id}} ({{admirer_rel.source_person.first_name}} {{admirer_rel.source_person.last_name}})</h2>

{% for member in lineup_set %}

	<img src="http://graph.facebook.com/{{member.LineupUser.username}}/picture?type=large" width=40 height=40>
		
{% endfor %}


{% for member in lineup_set %}
	<div id="lineup{{member.position}}">
		{{member.position}}: {{member.LineupUser.username}} <img src="http://graph.facebook.com/{{member.LineupUser.username}}/picture?type=large" width=60 height=60>
		<div id="choice">
			{% if member.decision = True %}
				You added {{member.LineupUser.first_name}} {{member.LineupUser.last_name}} as a crush!
			{% elif member.decision = False %}
				You added {{member.Lineup.first_name}} {{member.LineupUser.last_name}} as just-a-friend.
			{% else %}
				<a href="#" class="member_add" add_type="crush" username="{{member.LineupUser.username}}" name="{{member.LineupUser.first_name}} {{member.LineupUser.last_name}}">Add as crush</a> 
				<a href="#" class="member_add" add_type="platonic" username="{{member.LineupUser.username}}" name="{{member.LineupUser.first_name}} {{member.LineupUser.last_name}}">Add as platonic friend</a>
			{% endif %}
		</div>
	</div>
{% endfor %}


{% endblock %}
