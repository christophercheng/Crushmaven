<!DOCTYPE html>
<html lang="en">
    <head>
	    <meta http-equiv="Content-type" content="text/html"; charset="UTF-8" />
	    <meta name="description" content="When you already have someone in mind, but not sure they feel the same... Discover your relationship potential - safely and anonymously." />
	    <meta name="robots" content="all,index" />
	    <meta name="Revisit-After" content="30 Days" />
	    <meta http-equiv="X-UA-Compatible" content="IE=edge" /> <!-- ie8 - ignore compatibility option-->
		<title>Flirtally - {% block title %}{% endblock %}</title>    	
	    {% block extrahead %}{% endblock %}

	    <link rel="shortcut icon" type="image/x-icon" href="{{ STATIC_URL }}images/favicon_v2.png" />
	    <link rel="icon" type="image/x-icon" href="{{ STATIC_URL }}images/favicon_v2.png" /> 

	    <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/themes/base/jquery-ui.css">
		<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
	    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	    
		<!--<link type="text/css" href="/static/fbdater.css?t={% now "U" %}" rel="stylesheet"  />    -->
		<link type="text/css" href="/static/fbdater.css" rel="stylesheet"  />    
	    
	    <link type="text/css" href="/static/friend-selector/jquery.friend.selector-1.2.css" rel="stylesheet" />
	
	    <link rel="stylesheet" href="{{ STATIC_URL }}contactable/contactable_sw.css" type="text/css" />
		
    </head>
<body>
<script> 
jQuery(document).ready(function($) {

	<!-- AJAX CALL INITIALIZATION -->
	// default to 60 seconds for all ajax calls: (lineup initialization will require longer wait time)
	$.ajaxSetup({timeout: '60000'});
 
	<!-- INITIALIZE FB JS INTEGRATION -->
	window.fbAsyncInit = function() {
	  FB.init({ 
	  	appId: {{facebook_app_id}}, 
	  	status: true, 
	  	cookie: true,
	  	xfbml: true,
	  	oauth: true,
	  });
  	  	// Additional init code here
	}; // close window.fbAsyncINit
	// Load the SDK Asynchronously
  // Load the SDK asynchronously
  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/all.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));

	function login(connect_callback) {
	    FB.login(function(response) {
	        if (response.authResponse) {
	        		if (connect_callback)
	        			connect_callback();
	            // connected
	        } else {
	            // cancelled
	
	        }
	    });
	}// close function login

	/* -------  HANDLERS for Friend Selector and Contactable Form -------- */
	  $.getScript('/static/friend-selector/jquery.friend.selector-1.2.js').done(function(script,scriptStatus){
		  $(".bt-fs-dialog").fSelector({ // call the .fSelector function and send it a massive dictionary of option values
			  accessToken: "{{request.user.access_token}}",
			  facebookID: "{{request.user.username}}",
			  malePref:{% if request.user.gender_pref = 'F' %} false {% elif request.user.gender_pref = 'M' %} true {% else %} null{% endif %},
		    maleGender: {% if request.user.gender = 'F' %} false {% elif request.user.gender_pref = 'M' %} true {% else %} null{% endif %},
		    minimum_samegender_friends:"0",//"{{minimum_samegender_friends}}",
		    minimum_crushgender_friends:"0",//"{{minimum_crushgender_friends}}",
		    max:12,
			 excludeIds: "{% for crush_rel in request.user.crush_crushrelationship_set_from_source.all %}{{crush_rel.target_person.username}}{% if not forloop.last %},{% endif %}{% endfor %}",
		    closeOverlayClick: false,
		    overlayOpacity: "0.5",
		    overlayColor: '#000',
		    closeOnSubmit: true,
		    showSelectedCount: true,
		    color: "default",
		    showRandom:false,
		    lang: {
		      title: "Add Attractions",
		      searchText: "Enter a friend's name",
		      fbConnectError: "You must be logged in to Facebook in order to use this feature.",
		      selectedCountResult: "You have choosen {0} people.",
		      selectedLimitResult: "Limit is {0} people.",
		      ajaxError:"{{ajax_error}}",
		    },
		    onSubmit: function(response){
					add_friends_to_db(response);
		    },
		    onError: function(error_message){
		    	var display_message="{{generic_error_message}}";
		    	if (error_message!== 'undefined')
		    		display_message=error_message;
		    		
		    	window.alert_modal("Friend Selector Problem", display_message, $('#fs-dialog-box-wrap') );
		    },
		    onStart: function(){
		    	 $("#fs-dialog-box-wrap").draggable({handle:"#fs-dialog-title",containment:$("#fs-overlay")});
		    	 window.scrollTo(0,0); // hack to allow dialog to show - cause it always loads relative to fixed elements
		    	 //$('body').css('overflow-y','hidden !important');
		    },
		    });
		  /* ---------------------------------------------
		 	
			REQUEST SETUP Handling
		
			* -------------------------------------------- */
			
			$(".request_setup_link").fSelector({ // call the .fSelector function and send it a massive dictionary of option values
				  accessToken: "{{request.user.access_token}}",
				  facebookID: "{{request.user.username}}",
				  malePref:null,// {% if request.user.gender_pref = 'F' %} false {% elif request.user.gender_pref = 'M' %} true {% else %} null{% endif %},
			  maleGender: {% if request.user.gender = 'F' %} false {% elif request.user.gender_pref = 'M' %} true {% else %} null{% endif %},
			  minimum_samegender_friends:"0",//"{{minimum_samegender_friends}}",
			  minimum_crushgender_friends:"0",//"{{minimum_crushgender_friends}}",
			  max:12,
				  excludeIds: "{% for request_rel in request.user.crush_setuprequestrelationship_set_from_source.all %}{{request_rel.target_person.username}}{% if not forloop.last %},{% endif %}{% endfor %}",    
			  closeOverlayClick: false,
			  setupSelect:true,
			  overlayOpacity: "0.5",
			  overlayColor: '#000',
			  closeOnSubmit: true,
			  showSelectedCount: true,
			  color: "default",
			  showRandom:false,
			  lang: {
			  	buttonContinue:"Select",
			    title: "Request Setups from Friends",
			    searchText: "Enter a friend's name",
			    fbConnectError: "You must be logged in to Facebook in order to use this feature.",
			    selectedCountResult: "You have choosen {0} people.",
			    selectedLimitResult: "Limit is {0} people.",
			    ajaxError:"{{ajax_error}}",
			  },
			  onError: function(){
			  	window.alert_modal('Attraction Selection Problem', "{{generic_error_message}}",$('#fs-dialog-box-wrap') );
			  },
			  onStart: function(){
			  	 $("#fs-dialog-box-wrap").draggable({handle:"#fs-dialog-title"});
			  	 window.scrollTo(0,0); // hack to allow dialog to show - cause it always loads relative to fixed elements
			  },
			  onSubmit: function(response){
						var attraction_array = [];
						for (attraction in response)
							attraction_array.push(attraction.slice(0,-1));
						send_fb_requests(attraction_array);
			  }, // close off onSubmit function handler
			}); // close off .fSelector function handler
	}); // close off $.getScript for Friend Selector Dialogs

	  /* -----------    Handler For Contactable Form ---------- */
	  $.getScript('{{ STATIC_URL }}contactable/jquery.contactable_sw.js').done(function(script,scriptStatus){
			  $(function(){$('#contactable').contactable({csrf_token: '{{csrf_token}}'});});
		}); // close off $.getScript for Friend Selector Dialogs

	  
	  /* ---------------------------------------------
	 	
		CREDIT PURCHASE DIALOG HANDLING
	
	   * -------------------------------------------- */
	  
	$("#credit_check_modal").dialog({dialogClass:"credit_check_dialog blacktop",modal: true,resizable:false, autoOpen: false,width:410});
	
	
	window.purchase_feature = function(data){
		load_url="/credit_checker/";
		dialog_div = $("#credit_check_modal");
		dialog_div.attr("feature_id",data.feature_id)
		window.wait_modal_open();
		dialog_div.load(load_url,data,function(responseTxt,statusTxt,xhr){
			window.wait_modal_close();
			if (statusTxt!="success"){
					$(this).html(data.ajax_error);
			  }
			dialog_div.dialog("open");
			$(':focus').blur();
			dialog_div.dialog("moveToTop");
		}); 
		return false;
	};
	
	window.purchase_conversation = function(csrf_token,attraction_id,purchase_callback_name) {
		purchase_callback_name = typeof purchase_callback_name !== 'undefined' ? purchase_callback_name : "";
		data = {};
		data['csrfmiddlewaretoken']=csrf_token;
		data['success_path'] = '/messages/converse/' + attraction_id;	
		data['cancel_url'] =  '{{request.get_full_path}}';
		var unique_id = attraction_id;
		data['unique_id'] = unique_id;
		data['feature_id'] = '4';
		if (purchase_callback_name=='')
			data['purchase_callback_name'] = 'window.redirect_to_conversation(' + attraction_id + ')';
		else
			data['purchase_callback_name'] = purchase_callback_name;
		data['ajax_error']='{{ajax_error}}';
		purchase_feature(data);
	}; 
			   
		window.redirect_to_conversation=function(attraction_id){
		  	location.href="/messages/converse/" + attraction_id;
		};		  
	  
	  /* ---------------------------------------------
	 	
	 		APP INVITE MODAL
	 	
	 * -------------------------------------------- */
	window.app_invite_modal=null;
	$(".app_invite_link,#invite_interstitial_modal").on("click", ".app_invite", function(e) {
		e.preventDefault();
		// only initialize jquery modal dialog once per page load

		if (!window.app_invite_modal)
			window.app_invite_modal = $("#app_invite_modal").dialog({dialogClass:"app_invite_dialog",resizable:false, modal: true, autoOpen: false});
		window.app_invite_modal.html('<div id="site-loading"></div>');
		window.wait_modal_open();
		var crush_username=$(this).attr('crush_username');	
		var crush_fullname=$(this).attr('crush_fullname');
		var load_url="/app_invite_form_v2/" + crush_username + "/";
		window.app_invite_modal.load(load_url,{'crush_fullname':crush_fullname,'csrfmiddlewaretoken':'{{csrf_token}}' },function(responseText,textStatus,XHR){
			window.wait_modal_close();
			if (textStatus!="success"){
				if (!window.access_token_error(responseText))
					$(this).html("{{ajax_error}}");
			}
			else{
				window.app_invite_modal.dialog('open');
				$(':focus').blur();
			}
		});	
	});	
	
	//-------------  App Invite Interstitial ------------------
	// launch interstitial
	//
	//		inputs:
	//			json of attractions: attraction_username = attraction_full_name
	//			redirect page (where to go after dialog closes) 
	//		functionality:
	//			dynamically build dialog html elements based off of the inputted array
	
	window.invite_interstitial_modal=null;
	window.invite_interstitial_modal_redirect_url="";
	window.launch_invite_interstitial = function(attraction_json,redirect_url) {
			// only initialize jquery modal dialog once per page load
			
			if (!window.invite_insterstitial_modal)
				window.invite_interstitial_modal = $("#invite_interstitial_modal").dialog({dialogClass:"invite_interstitial_dialog",resizable:false, width: '450px',modal: true, close: function(){location.href=redirect_url;},autoOpen: false});
			else
				window.invite_interstitial_modal.dialog({close: function(){if (redirect_url!="") location.href=redirect_url;}})
			var modal_html ="";
			modal_html += '<div class="modal_instructions">To get a response from your newly added attraction(s), please help us get them signed into the application.</div>';
			modal_html += '<div class="modal_main_content">';
				
			
			var counter = 0;
			for (var username in attraction_json) {
				counter++;
				if (counter == 1)
					modal_html += '<div class="attraction_invite_row first_row">';
				else
					modal_html += '<div class="attraction_invite_row">';
					// picture
					modal_html +='<img src="http://graph.facebook.com/' + username + '/picture?width=30&height=30">';
					// full name
					modal_html +='<span class="attraction_invite_full_name">' + attraction_json[username] + '</span>';
					// invite button (or invite sent text)
					modal_html +='<div class="attraction_invite_button" username="' + username + '"><button class="app_invite" crush_username="' + username + '" crush_fullname="' + attraction_json[username] + '">Send Anonymous Invite</button></div>';
				modal_html += '</div>'; //close off attraction_invite_row div
			}
				
			modal_html += '</div>';//close off dialog_main_content div
			modal_html += '<div class="ui-dialog-buttonpane">';
			modal_html += '<div class="ui-dialog-buttonset">';
			modal_html += '<button type="button" onclick="window.invite_interstitial_modal.dialog(\'close\');" class="site_dialog_button site_dialog_cancel_button" ><span class="ui-button-text">send invites later</span></button>';
			modal_html += '</div></div>';
			
			window.invite_interstitial_modal.html(modal_html);
			window.invite_interstitial_modal.dialog('open');
			$(':focus').blur();
	};
	
	
	// input: attraction: username represents the attraction that was just invited  
	// functionality: auto redirect to inputted redirect page if all attraction invites sent
	//	 		if redirect page is same as current page, just close dialog
	//	 		if at least one attraction invite not sent, then
	//			replace button of newly invited attraction with 'invite(s) sent' 
	window.update_invite_interstitial = function(attraction_username){
		if (!window.invite_interstitial_modal || !window.invite_interstitial_modal.dialog( "isOpen" ))
			return false;
		if (window.app_invite_modal)
			window.app_invite_modal.dialog('close');
		 // search for the associated button and update it's html
		target_element = $('#invite_interstitial_modal .modal_main_content .attraction_invite_row .attraction_invite_button[username=' + attraction_username + ']');
		target_element.html('invite(s) sent');
		
		// if no buttons exist, then auto close the dialog and redirect it 
		if ($('.attraction_invite_button button').length == 0)
			window.invite_interstitial_modal.dialog("close");
	}
	
  function add_friends_to_db(response)
  //response is a json object of username:fullname with username having extra character at end representing friendship type
  {           
                window.wait_modal_open();
                var result_dictionary = {};
                var attraction_invites_json={};
                result_dictionary["csrfmiddlewaretoken"]="{{csrf_token}}";
                for (attraction in response){
                        result_dictionary[attraction.slice(0,-1)]=attraction.slice(-1);
                        attraction_invites_json[attraction.slice(0,-1)]=response[attraction];
                };
        $.post('/ajax_add_crush_targets/',result_dictionary, function(){
                // on success redirect to the crush page
                window.wait_modal_close();
                window.launch_invite_interstitial(attraction_invites_json,'/attractions'); 
                //document.location.href='/attractions/'; // reload page
        }).fail(function(error){
                window.alert_modal("Add Attraction Problem", error.responseText,$('#fs-dialog-box-wrap') );
  });
  }
	// -------------  CSS additions ------------------
	// HANDLE SETTINGS MENU CLICK
	function openSubMenu() {
		clearTimeout(window.submenu_toggle);
		var show_me = $(this).find('ul');
		$(this).find('a').css('color','white');
		window.submenu_show=setTimeout(function(){
			if (show_me.parent().is(":hover")){
				$('.popup').hide();
				show_me.show(100);
			}
		},100); 
	};


	$.maxZIndex = $.fn.maxZIndex = function(opt) {
	    /// <summary>
	    /// Returns the max zOrder in the document (no parameter)
	    /// Sets max zOrder by passing a non-zero number
	    /// which gets added to the highest zOrder.
	    /// </summary>    
	    /// <param name="opt" type="object">
	    /// inc: increment value, 
	    /// group: selector for zIndex elements to find max for
	    /// </param>
	    /// <returns type="jQuery" />
	    var def = { inc: 10, group: "*" };
	    $.extend(def, opt);    
	    var zmax = 0;
	    $(def.group).each(function() {
	        var cur = parseInt($(this).css('z-index'));
	        zmax = cur > zmax ? cur : zmax;
	    });
	    if (!this.jquery)
	        return zmax;
	
	    return this.each(function() {
	        zmax += def.inc;
	        $(this).css("z-index", zmax);
	    });
	}
	$("#alert_modal").dialog({dialogClass:'alert_modal_dialog blacktop',resizable:false, modal: true, autoOpen: false,buttons: {"Ok": function() {$(this).dialog("close");}}});
	$("#wait_modal").dialog({dialogClass:'wait_modal_dialog',resizable:false, height:80,width:300,modal: true, autoOpen: false}); 
 
	window.wait_modal_open=function(custom_message,calling_jquery_element){
		var message="please wait...";
		if (custom_message !== 'undefined' && custom_message !== "")
			message=custom_message;
		
		if (!$("#wait_modal").dialog("isOpen")){
				$('#wait_modal').dialog("open");
		}
		
		if (typeof calling_jquery_element !== 'undefined')	{
			var top_z_index=parseFloat($(calling_jquery_element).css('z-index'));
			var dialog_index = top_z_index + 2;
			var overlay_index = top_z_index + 1;
			var old_dialog_z = $(".wait_modal_dialog").css('z-index');
			$(".wait_modal_dialog").css('z-index',dialog_index.toString());
			var old_overlay_z = $(".ui-widget-overlay").css('z-index'); // set back to this z-index when close pressed
			$('.ui-widget-overlay').css('z-index',overlay_index.toString()).addClass('wait_mode');
			$('#wait_modal').dialog("option",{beforeClose:function(){$('.wait_modal_dialog').css('z-index',old_dialog_z);$('.ui-widget-overlay').css('z-index',old_overlay_z).removeClass('wait_mode')}});
		}
		$(".ui-widget-overlay").fadeTo(0,.1);
		$("#wait_modal").html(message);
	};  

	window.wait_modal_close=function(){
		if (!$("#wait_modal").dialog("isOpen"))
			return;
		$(".ui-widget-overlay").fadeTo(0,.6);//put it back where it used to be
	 		$('#wait_modal').dialog("close");
	 };  
  
	 window.alert_modal=function(title, message,calling_jquery_element){
	   $("#alert_modal").html(message);
	   $("#alert_modal").dialog({dialogClass:'alert_modal_dialog blacktop',title:title,show:'fade',beforeClose:function(){$(".ui-widget-overlay").css('z-index',old_overlay_z);window.wait_modal_close()}});
		$('#alert_modal').dialog("open");
		
		if (typeof calling_jquery_element === 'undefined'){
				var top_z_index = parseInt($.maxZIndex());
		}
		else {
			var top_z_index=parseFloat($(calling_jquery_element).css('z-index'));
		}
		var dialog_index = top_z_index + 2;
		var overlay_index = top_z_index + 1;
		$(".alert_modal_dialog").css('z-index',dialog_index.toString());
		var old_overlay_z = $(".ui-widget-overlay").css('z-index'); // set back to this z-index when close pressed
		$(".ui-widget-overlay").css('z-index',overlay_index.toString());
		$(':focus').blur();
  };  
  
  window.access_token_error=function(responseText){
		if (responseText.indexOf("HTTPError") != -1){
		  reauthorize_user();
			return true;
		}
		else 
			return false;
	};

	var reauthorize_user=function(){
		window.alert_modal('User Authentication', "For your security, we must periodically re-confirm your Facebook identity.  Our apologies for the inconvenience.",$('#fs-dialog-box-wrap'));
		setTimeout(function(){location.href="/facebook/login"},1000);
	};
	
	var send_fb_invite = function(recipient_id,crush_short_name){
  	FB.ui({method: 'send',
  				name: crush_short_name + " has an admirer!",
  				to: recipient_id,
  				link:'http://www.flirtally.com',
  				description:'Flirtally is a new matchmaking service for people who already have someone in mind - for themselves or for a friend.  Find out if someone you know and like feels the same at Flirtally.com.'
      },
      function(response){
         // regardless of whether user cancels or sends message, reload the appropriate attraction page
         if (response != null){	
		  	$(".inactive_crushed_friends").load('/ajax_friends_with_admirers_content/' + recipient_id,function(responseText,textStatus,xhr){
				if (xhr.status==405)
					reauthorize_user();
  			});
  		} 
      }      
    );// close off fb.ui
  }; // close off send_fb_message
   
  $(".inactive_crushed_friends").on('click', '#send_fb_invite', function(){
           var crush_id = $(this).attr('crush_username');
           var crush_name = $(this).attr('crush_name');
           send_fb_invite(crush_id,crush_name);
  });
  
// QUERY INACTIVE FRIENDS WITH ADMIRERS
$(".reprocess_friends_with_admirers_section").parent('ul').load('/ajax_friends_with_admirers_content/',function(responseText,textStatus,xhr){
	if (xhr.status==405)
  			reauthorize_user();
  }); 
// INITIALIZE FEEDBACK FORM 
 
function closeSubMenu() {
	clearTimeout(window.submenu_toggle);
	var hide_me = $(this).find('ul');
	$(this).find('a').css('color','');
	window.submenu_toggle=setTimeout(function(){$(hide_me).hide(200);},100);
};
$('.drop_down_menu_link > li.submenu').hover(openSubMenu,closeSubMenu);
$('#center_header_menu > li.submenu').hover(function(){$('#get_started_link').css('color','white')},function(){$('#get_started_link').css('color','#E02B50')});

//HANDLE clicking of drop down menu links
$('.header_container .drop_down_menu_link li.submenu').click(function(e){
	e.stopPropagation();
	var menu_element = $(this).find('ul');
	var menu_element_id=menu_element.attr('id');
	$('.popup:not(#' + menu_element_id + ')').hide();
	if ($(menu_element).is(":visible")){
		$(menu_element).hide(200);
	}
	else{
		$(menu_element).show(200);
	}
});

// HANDLE TITLE BAR OPTIONS SUBMENU CLICK
$('.title_bar_option a').bind('click',function(){
	$(this).parent().children('ul').toggle();
});
	
// auto close any popups when clicking elsewhere
$('body').bind('click',function(){
	$('.popup').hide();
});
$('body').on('click',".popup_link",function(e){
  e.stopPropagation();
});

//$('a.bt-fs-dialog').hover(function(){$(this).delay(40).animate({top:'+=3',left:'+=3'},100);},function(event){event.stopPropagation();$(this).animate({top:'-=3',left:'-=3'},50);});
//$('a.bt-fs-dialog').hover(function(){$(this).delay(40).animate({top:'+=2',left:'+=2',height:'-=2',width:'-=2'},10);},function(event){event.stopPropagation();$(this).animate({top:'-=2',left:'-=2',height:'+=2',width:'+=2'},50);});
//$('a.block_button').hover(function(){$(this).delay(40).animate({top:'+=2',left:'+=2'},10);},function(event){event.stopPropagation();$(this).animate({top:'-=2',left:'-=2'},50);});
 
//$('.navbar li.inactive a').hover(function(){$(this).animate({borderTopWidth:'4px',borderLeftWidth:'3px'},100);},function(event){event.stopPropagation();$(this).animate({borderTopWidth:'0px',borderLeftWidth:'0px'},100);});

	function send_fb_requests(attraction_array){
	  var csrf_data={};
    csrf_data["csrfmiddlewaretoken"]="{{csrf_token}}";
    window.wait_modal_open("processing message...");
    source_person_last_name="{{request.user.last_name}}";
    source_person_first_name = "{{request.user.first_name}}"
    source_person_short_name = source_person_first_name + " " + source_person_last_name[0] + ".";
		FB.ui({method: 'send',
	  				name: source_person_short_name + " would like your help.",
	  				to: attraction_array[0],
	  				link:'http://www.flirtally.com',
	  				description:"Flirtally is a new matchmaking service that makes it easy to set your friends up with one another. Let us know who'd make a good match for " + source_person_first_name + "!"
			      },
			      function(response){
			    	  		window.wait_modal_close();
							if (response != null){
								$.post('/ajax_create_setup_request/' + attraction_array[0] + '/',csrf_data, function(){
									attraction_array.splice(0,1);
									if (attraction_array.length)
										send_fb_requests(attraction_array);  	
									else // reload page so that the new requests can be processed by base.html javascript
										window.location.href="/setups_for_me/";
								});
							}
							else {
								attraction_array.splice(0,1);
								if (attraction_array.length)
									send_fb_requests(attraction_array);  	
								else // reload page so that the new requests can be processed by base.html javascript
									window.location.href="/setups_for_me/";
							}
			  		} // close off function (response)   
		   	 	);// close off fb.ui
	};
/* ---------------------------------------------
 	
		Help Popup Animation
	
* -------------------------------------------- */
	
	//handle help icon show and hide
	$('.new_user_instructions').each(function(){window.scrollTo(0,0);$(this).delay(500).show(1000)});
	$('.new_user_sub_instructions').each(function(){window.scrollTo(0,0);$(this).delay(500).show(1000)});
	$('.new_user_instructions .help_icon').click(function(){
		$(this).parent().hide(500);
		$('.new_user_sub_instructions').hide(500);
	});
 /* ---------------------------------------------
 	
 		SETUP CREATION MODAL
 	
 * -------------------------------------------- */

	window.setup_create_modal=null;
	$("a.set_up_friend_link").click(function(e) {
		e.preventDefault();
		// only initialize jquery modal dialog once per page load

	//if (!window.setup_create_modal)
		window.setup_create_modal = $("#setup_create_modal").dialog({
		dialogClass:"setup_create_dialog",resizable:false, modal: true,show:'fade',autoOpen: false,close:function(){location.reload();},width:500});
		window.setup_create_modal.html('<div id="site-loading"></div>');
		var target_person_username = $(this).attr('target_person_username');
		var load_url="/setup_create_form/";
		if (target_person_username)
			load_url = load_url + target_person_username + '/';
		window.setup_create_modal.load(load_url,function(responseText,textStatus,XHR){
			if (textStatus!="success"){
				if (!window.access_token_error(responseText))
					$(this).html("{{ajax_error}}");
			}
			window.setup_create_modal.dialog('open');
			$(':focus').blur();
		});	
	}); // close off .click(function(e){

window.handle_window_resize=function(){
	$('.ui-dialog-content:visible').each(function(){
		var dialog = $(this).data("dialog");
		dialog.option("position","center");
		});
};
var timeoutPointer;
$(window).resize(function(){
	clearTimeout(timeoutPointer);
	timeoutPointer = setTimeout(window.handle_window_resize,100);
});

/* ---------------------------------------------
	
	NEW USER INSTRUCTION - SHOW MORE LINK HANDLER

* -------------------------------------------- */

$('.show_more').click(function(){
	$(this).hide();
	$('.second_instruction_section').show(200);
	$('.first_instruction_section .show_less').show();
	setTimeout(function(){$('.new_user_instructions').addClass('expanded');},100);
	
});
$('.show_less').click(function(){
	$(this).hide();
	$('.show_more').show();
	$('.second_instruction_section').hide(200);
	setTimeout(function(){$('.new_user_instructions').removeClass('expanded');},100);
});

}); // close of jQuery(document).ready

</script>
<div id="fb-root"></div> 
<div class="header">
	<div class="header_container">{% include "navigation_top.html" %}</div>
</div><!-- close off header divs -->

<div class="main_container">
	<div class="left_sidebar">
		<div class="left_sidebar_container">{% include "navigation_left.html" %}</div>
	</div> <!-- close off left_sidebar -->
	<div class="center_panel">
		<div class="center_panel_container">
			{% block content %}
			{% endblock %}
		</div> <!-- close off center_content_container -->
	</div> <!-- close off center_panel -->
	<div class="right_sidebar">
	<div class="right_sidebar_container">{% include "navigation_right.html" %}</div>
</div> <!-- close off right_sidebar -->
</div> <!-- close off main_container -->
<div id="alert_modal" title="Something's Not Right"></div>
<div id="wait_modal">Please Wait</div>
<div id="app_invite_modal" title="Send Anonymous Invites"></div>
<div id="invite_interstitial_modal" title = "One Last Thing!"></div>
<div id="credit_check_modal" title="Feature Purchase"></div>
<div id="setup_create_modal" title="Set up a Friend"></div>
<div id="contactable"></div><!-- contactable html placeholder -->
</body>
</html>
