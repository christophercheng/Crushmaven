<script>
$(document).ready(function() 
{
	
	window.survey_user = function(reason){
		{% if completed_survey != True %}
			var survey_dialog = $("#survey_modal_div").dialog({dialogClass:'survey_dialog blacktop',modal: true, draggable:false,show: 'fade',width:375,resizable:false,autoOpen: true,open: function(event, ui) {$("body").css({ overflow: 'hidden' }) },beforeClose: function(event, ui) {$("body").css({ 'overflow-x':'auto','overflow-y': 'scroll' })}});
	   {% endif %}
	};
	window.morph_dialog = function(){
		window.purchase_dialog_div.dialog('close');
		window.wait_modal_open("Redirecting to Paypal");
		$('form').trigger('submit');
	};
	
	$( window ).unload(function() {
		window.wait_modal_close(); // close the wait modal once we get to paypal, this way if user hits back button we don't still see wait modal
		});

	$.getScript('{{ STATIC_URL }}qtip/jquery.qtip.min.js').done(function(script,scriptStatus){
		$(".credit_check_dialog .ui-dialog-titlebar .help_icon").qtip({
			content:{
				text:$('#credits_help_content'),
				title:'What are credits?'
			},
			show:{
				delay:0,
			},
			hide:{
				delay:500,
				fixed:true,
			},
			style:{
				classes: 'qtip-blue qtip-rounded qtip-shadow',
				tip:{
					corner:true
				}
			}
		});	
	});//close off getScript
	/*  TOOLTIP SUPPORT */

	$(".tooltip_close").click(function(){
		$('.qtip').hide();
	});

	$(".tooltip_subtitle").click(function(){
		var current_content = $(this).parent().children('.tooltip_content');
		$(this).parent().parent().find('.tooltip_relatedcontent').not(current_content).hide();
		if (current_content.css("display")=="none")
			current_content.css("display","block")
		else
			current_content.css("display","none")
	})
});
</script>

<div id="credit_check_container" class= "credit_insufficient_container">
	<div id="feature_description">
		{{ feature_name }}
	</div>
	<div id="site-loading"></div>
	<div id="purchase_description_container">
		
		<span class="credit_amount">You have insufficient credits ({{credit_available}}) to make this purchase.</span>
	
	</div><!--  close off purchase_description_container -->


<form method="post" action='{{ paypal_url }}' >{% csrf_token %}

	<div id="credit_purchase_selection">
		<h3 id="purchase_title">Purchase More Credit:</h3>
		<span class="purchase_option"><input type = "radio" name="amount" value="5" onClick="document.getElementById('item_name_field').value='5 Credits';document.getElementById('return').value='{{paypal_success_url}}&credit_amount=5';document.getElementById('notify_url').value='{{paypal_notify_url}}5/'"><span class="credit_option_amount">5 credits</span> for $5 USD</span>
		<span class="purchase_option"><input type = "radio" name="amount" value="9" checked onClick="document.getElementById('item_name_field').value='10 Credits';document.getElementById('return').value='{{paypal_success_url}}&credit_amount=10';document.getElementById('notify_url').value='{{paypal_notify_url}}10/'"><span class="credit_option_amount">10 credits</span> for $9 USD &nbsp;<span class="percentage_bonus">10% off!</span></span>
		<span class="purchase_option"><input type = "radio" name="amount" value="17" onClick="document.getElementById('item_name_field').value='20 Credits';document.getElementById('return').value='{{paypal_success_url}}&credit_amount=20';document.getElementById('notify_url').value='{{paypal_notify_url}}20/'"><span class="credit_option_amount">20 credits</span> for $17 USD &nbsp;<span class="percentage_bonus">15% off!</span></span>
		<span class="purchase_option"><input type = "radio" name="amount" value="32" onClick="document.getElementById('item_name_field').value='40 Credits';document.getElementById('return').value='{{paypal_success_url}}&credit_amount=40';document.getElementById('notify_url').value='{{paypal_notify_url}}40/'"><span class="credit_option_amount">40 credits</span> for $32 USD &nbsp;<span class="percentage_bonus">20% off!</span></span>
		<span class="purchase_option"><input type = "radio" name="amount" value="75" onClick="document.getElementById('item_name_field').value='100 Credits';document.getElementById('return').value='{{paypal_success_url}}&credit_amount=100';document.getElementById('notify_url').value='{{paypal_notify_url}}100/'"><span class="credit_option_amount">100 credits</span> for $75 USD &nbsp;<span class="percentage_bonus">25% off!</span></span>
		<img src="{{STATIC_URL}}images/paypal_secure_payments.jpg" id="paypal_image">
		  <input type="hidden" name="cmd" value="_xclick">
		  <input type="hidden" id="credit_amount" name="credit_amount" value="10">
		  <input type="hidden" name="business" value="{{ paypal_email }}">
		  <input type="hidden" id="item_name_field" name="item_name" value="10 Credits">
		  <input type="hidden" name="currency_code" value="USD">
		  <input type="hidden" name="return" id="return" value="{{paypal_success_url}}&credit_amount=10">
		  <input type="hidden" name="notify_url" id="notify_url" value="{{paypal_notify_url}}10/">
		  <input type="hidden" name="cancel_return" value="{{ paypal_cancel_url}}/">
	</div><!-- close off credit_purchase_selection -->
	<div class="ui-dialog-buttonpane">
		<!-- <span id="purchase_button_description">You will be directed to PayPal</span> -->
		<div class="ui-dialog-buttonset paypal_redirect_buttonset">
		<input type='image' id="credit_deduct_ok" onclick="window.morph_dialog();" alt="Make payments with PayPal - it's fast, free and secure!" src="{{STATIC_URL}}images/paypal_buy_now_button.gif"</input> 
		<button type='button' onclick="window.purchase_dialog_div.dialog('close');window.survey_user();" class="ui-button site_dialog_button site_dialog_cancel_button" ><span class="ui-button-text">Cancel</span></button> 
		</div>
	</div><!-- close off button_bar -->
</form>

</div> <!-- close off credit_check_container -->

<span class="help_dialog_content" id="credits_help_content">
<span class="tooltip_content tooltip_maincontent">
Credits are 'virtual currency' that you can spend on certain features of the site.  
For example, if we get your crush to respond, you will need to spend credits to see their response.  
<i>Note:</i> we give all new users 1 credit to start.
</span>
<span class="related_subsections">related q&a:</span>
<span class ="tooltip_subsection">
<span class="tooltip_subtitle">
	How many credits do I have?
</span>
<span class="tooltip_content tooltip_relatedcontent">
 You currently have {{ request.user.site_credits}} {% if request.user.site_credits == 1 %}credit{% else %} credits{% endif %}.  You can always check your available credits under the settings menu (in the top right hand corner of the site).
</span>
</span>
<span class ="tooltip_subsection">
<span class="tooltip_subtitle">
	Why do we charge credits for certain features?
</span>
<span class="tooltip_content tooltip_relatedcontent">
	Charging credits is the primary way that we make money from this service and put food on our tables.  
	We will only charge you when we have performed a valuable service on your behalf, for example if we determine if your crush feels the same or not.
</span>
</span>
<span class ="tooltip_subsection">
<span class="tooltip_subtitle">
	What if I run out of credits?
</span>
<span class="tooltip_content tooltip_relatedcontent">
You can always purchase more credits from within the settings menu (in the top right hand corner of the site).  We accept payment via Paypal and most major credit cards (also via our Paypal service).
</span>
</span>
<span class ="tooltip_subsection">
<span class="tooltip_subtitle">
	How much do credits cost?
</span>
<span class="tooltip_content tooltip_relatedcontent">
	Each credit currently costs $1 USD.  However, we provide volume purchase discounts - the more you purchase at one time, the greater the discount you will receive.
</span>
</span>
<span class ="tooltip_subsection">
<span class="tooltip_subtitle">
	What if I don't have a Paypal account or credit card to purchase more credits?
</span>
<span class="tooltip_content tooltip_relatedcontent">
	We are considering developing a feature that will allow you to transfer credits from another user.  
	Please provide us with your feedback to let us know if you think this is useful.  
	Our feedback tab is located on the bottom right hand corner of the site.
</span>
</span>
<span class="tooltip_close">close</span>
</span>
<div id="survey_modal_div" title="Your Feedback Is Important!">
	<div class="modal_container">Would you like to earn a free credit to use on any feature?  Simply complete our feedback form, and we'll instantly update your account.
	</div><!-- close off buttonpane -->	
	<div class="ui-dialog-buttonpane">
	<div class="ui-dialog-buttonset">
		<button type='button' onclick="$('#survey_modal_div').dialog('close');" class="site_dialog_button site_dialog_cancel_button" ><span class="ui-button-text">No Thanks</span></button> 
		<button type='button' onclick="$('#survey_modal_div').dialog('close');location.href='/feedback_form';" class="site_dialog_button" ><span class="ui-button-text">Let's Do It!</span></button> 
	</div><!-- close off buttonset -->
	</div><!-- close off buttonpane -->
</div>


